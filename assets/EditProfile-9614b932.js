import{i as h,j as e,p as r,g as S,u as B,W as O,c as f}from"./index-b4f137eb.js";import{r as d}from"./react-7b82c02c.js";import{D as j}from"./default-profile-3d4ff587.js";import{u as T,a as $}from"./reactRouter-08e27dd4.js";import"./extra-3c07f53d.js";const k="xKHh",q="_7YBS",_="tCbo",x={button:k,primary:q,secondary:_};function b({onClick:a,type:s,text:m}){const l=s==="primary"?x.primary:x.secondary;return e.jsx("button",{type:"button",onClick:a,className:`${x.button} ${l}`,children:m})}b.propTypes={onClick:h.func,type:h.oneOf(["primary","secondary"]).isRequired,text:h.string.isRequired};function P({handleSaveProfile:a,handleCancel:s}){return e.jsxs("div",{className:"w-1/2 flex justify-between gap-3",children:[e.jsx(b,{type:"primary",onClick:a,text:"확인"}),e.jsx(b,{type:"secondary",onClick:s,text:"취소"})]})}P.propTypes={handleSaveProfile:r.func.isRequired,handleCancel:r.func.isRequired};const D="DtR6",W="Ix8B",H="_--gI",Y="EfUi",K="_13Ys",y={profileListSection:D,profileListWrapper:W,editProfileSection:H,editButton:Y,editInput:K};function w({isLoading:a,updatedUser:s,profileData:m,handlePosterChange:l,handleNameChange:n}){return e.jsxs("div",{className:y.editProfileSection,children:[e.jsx("button",{type:"button",className:`${y.editButton} `,children:a?e.jsx("div",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"poster",className:"cursor-pointer",children:e.jsx("img",{src:s!=null&&s.poster?s==null?void 0:s.poster:S(m,"poster"),alt:"유저 프로필 이미지",onError:c=>{c.target.onerror=null,c.target.src=j},className:"w-[13.87rem] h-[13.875rem] object-cover opacity-50"})}),e.jsx("input",{type:"file",id:"poster",accept:".jpg,.png,.svg,.webp",onChange:l,style:{display:"none"}})]})}),e.jsxs("div",{className:"editName w-1/2",children:[e.jsx("label",{htmlFor:"username",children:e.jsx("input",{type:"text",name:"username",id:"username",value:s.username?s.username:m.username,onChange:n,maxLength:"10",className:y.editInput})}),e.jsx("p",{className:"text-base text-neutral-400 my-2",children:"* 2자 이상 10자 이내의 한글, 영문, 숫자 입력 가능합니다."})]})]})}w.propTypes={isLoading:r.bool,updatedUser:r.shape({username:r.string,poster:r.string,posterFile:r.string}),profileData:r.shape({username:r.string,poster:r.string}),handlePosterChange:r.func,handleNameChange:r.func};function U(){return e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("h2",{className:"text-4xl text-center font-bold",children:"프로필 편집"})})}function Q(){const a=T(),l=$().pathname.split("/").pop(),{storageData:n}=B("pocketbase_auth"),[c,v]=d.useState({username:""}),[L,N]=d.useState(!0),[p,u]=d.useState({username:"",poster:"",posterFile:null});console.log(l),d.useEffect(()=>{var i;(async()=>{try{N(!0);const t=await f.collection("profile").getOne(l);v(t),console.log(c);const g=p.poster||(t!=null&&t.poster?S(t,"poster"):j);u({username:t==null?void 0:t.username,poster:g,posterFile:null})}catch(t){console.log(t)}finally{N(!1)}})((i=n==null?void 0:n.model)==null?void 0:i.id)},[l,n]),console.log(c),console.log(p);const C=async(o,i)=>{try{return await f.collection("profile").update(o,i)}catch(t){throw console.error(t),t}},F=o=>{u({...p,username:o.target.value})},R=o=>{o.target.files[0]&&u({...p,poster:URL.createObjectURL(o.target.files[0]),posterFile:o.target.files[0]})};console.log(l);const E=async()=>{var o;try{const i=new FormData;i.append("username",p.username),p.posterFile&&i.append("poster",p.posterFile),await C(c.id,i);const t=await f.collection("profile").getOne(l);console.log(t);const g=f.files.getUrl(t,t.poster);u({username:t.username,poster:g||j,posterFile:null}),alert("저장 완료!"),a(`/profile/${(o=n==null?void 0:n.model)==null?void 0:o.id}`)}catch(i){console.error(i)}};console.log(c);const I=()=>{var o;window.confirm("이 페이지를 벗어나면 변경된 내용은 저장되지 않습니다. 그래도 진행하시겠습니까?")?a(`/editprofiles/${(o=n==null?void 0:n.model)==null?void 0:o.id}`):console.log("프로필 편집 취소")};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx("title",{children:"타잉 7조 - 프로필 편집 페이지"}),e.jsx("meta",{name:"description",content:"멋쟁이 사자처럼 6기 7조의 파이널 프로젝트 - 티빙 클론코딩 프로필 편집 페이지"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:title",content:"타잉 프로필 편집 페이지"}),e.jsx("meta",{property:"og:description",content:"프로젝트 타잉 프로필 편집 페이지"}),e.jsx("meta",{property:"og:image",content:"https://github.com/FRONTENDSCHOOL6/react-project-7/assets/101504272/1eb89fd9-eb47-4be6-be3d-a5746fb33abd"}),e.jsx("meta",{property:"og:url",content:"https://frontendschool6.github.io/react-project-7/#/editprofile/:id/:id"})]}),e.jsx("section",{className:"bg-black w-screen h-screen flex items-center justify-center text-white my-auto relative pt-[2rem] lg:pt-[1.5rem] md:pt-[1rem]",children:e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-full gap-10 w-2/3",children:[e.jsx(U,{}),e.jsx(w,{isLoading:L,updatedUser:p,profileData:c,handlePosterChange:R,handleNameChange:F}),e.jsx(P,{handleSaveProfile:E,handleCancel:I})]})})]})}export{Q as default};
