import{p as r,j as e,d as F,N as P,P as O,f as $,h as q,c as T,W as Y,g as _}from"./index-b4f137eb.js";import{r as o}from"./react-7b82c02c.js";import{e as Z}from"./reactRouter-08e27dd4.js";import"./extra-3c07f53d.js";const G="l8--",J="aJfT",z="xXbq",K="e67c",Q="P0pX",W="ZIqZ",ee="Ihk1",te="lI6k",se="_9xbH",re="wj98",ie="vMI8",ne="toXg",oe="yf5t",ae="Y0D-",le="X6OP",ce="-ldP",de="_0-rw",pe="rRQH",me="_5tHo",ue="uagu",he="Bonk",xe="f93p",ge="VB5A",fe="IuFi",be="T6YH",we="pXCt",ve="azvj",je="jsp9",ye="EV70",Ne="TkHi",Ie="G9tB",Re="Zt2o",Te="NZ60",Se="njvt",ke="_6eYt",Be="_5ndV",Ce="Mnef",qe="IMRP",_e="Dkuf",Ee="_5vGo",Fe="IdrJ",Pe="_0Nlh",Oe="tNkc",$e="bYUD",De="D0Ok",Me="Z2Xr",Ae="BwJP",Ue="_4jer",Le="xENC",He="qVUm",Ve="OgZ5",Xe="qrUP",Ye="YCS-",Ze="qxMK",Ge="DLC5",Je="_4Qt1",ze="_7opu",Ke="i2Fh",Qe="Ya0v",We="Ap7N",et="LVaN",tt="t06S",st="_7-27",rt="PjwE",t={container:G,"sr-only":"BdGs",invisible:J,fixed:z,absolute:K,relative:Q,"inset-0":"f8ye","-left-[1.0625rem]":"p0i4","-top-1":"xtQp","-top-4":"mAYP","bottom-[0%]":"_6yj1","left-[-20%]":"iMoz","left-[7%]":"TcgU","right-0":"BvOn","right-5":"U8i5","right-[24px]":"AenE","right-[7%]":"GK2e","top-3":"FzsK","top-[5%]":"amc-","z-10":"rhX1","m-2":"AdzG","mx-auto":"_8-8b","my-1":"THOm","my-1.5":"cqP7","my-2":"SXI6","my-3":"XEsM","my-4":"_0-fX","my-5":"_296b","my-[5%]":"AXeu","my-auto":"ntZv","mb-10":"fabv","mb-3":"-Oy2","mb-4":"iJdd","mb-[0.9375rem]":"KH64","mb-[1%]":"HQLr","mb-[2%]":"C0Jj","mb-[4%]":"lT-Q","ml-2":"tf3W","ml-5":"_3zct","ml-[0.3125rem]":"RYhR","ml-[3%]":"LOyI","ml-[3rem]":"HTcM","mr-[2.375rem]":"vTxv","mt-1":"DLF-","mt-1.5":"xNgH","mt-2":"zLja","mt-3":"Bqso","mt-4":"qYGW","mt-8":"_1PeR","mt-[0.2em]":"_1Svj","mt-[1.5625rem]":"N0cR","mt-[1rem]":"QA1n","box-border":"blgR",block:W,"inline-block":"nwIw",flex:ee,table:te,contents:se,hidden:re,"h-1/4":"jOjI","h-10":"ng-O","h-16":"qrw9","h-2":"t8FU","h-20":"_9aq3","h-8":"_4hPM","h-[0.0625rem]":"Ht05","h-[100vh]":"iQcI","h-[13.875rem]":"Oc3Y","h-[2.375rem]":"aWUG","h-[4rem]":"_7bzy","h-auto":"_6GBo","h-full":"mz79","h-screen":"gOG6","min-h-[3.5rem]":"xmI9","min-h-[3rem]":"_-5vY","min-h-full":"QZeh","min-h-min":"ZqRh","w-1/2":"_9-7e","w-10":"_4w4Y","w-2":"ar--","w-2/3":"pFVC","w-2/5":"fVyM","w-6/12":"m6nF","w-[13.87rem]":"TIW2","w-[2.375rem]":"lPdI","w-[23%]":"T4Rm","w-[30%]":"Anox","w-[35%]":"f2iK","w-[4rem]":"_8KAr","w-[5%]":"h-fp","w-[50%]":"H9w5","w-[6.5%]":"sg25","w-[60%]":"nLFO","w-auto":"mblZ","w-full":"F4F5","w-screen":"fjM6","flex-grow":"KvA2","table-fixed":"_19zF","-translate-x-1/2":"zNTi","-translate-y-1/2":"ZgGr",transform:ie,"cursor-not-allowed":"RB1Z","cursor-pointer":"ZGnr","list-none":"OGGK","flex-row":"gAeF","flex-col":"qy7E","flex-wrap":"HPPn","items-center":"FhR3","justify-center":"baCN","justify-between":"RyZr","justify-around":"_5IFa","gap-1":"_6sHY","gap-10":"N1Cz","gap-2":"gnj-","gap-3":"qCkP","gap-5":"UJ2O","gap-6":"ThZl","gap-7":"D0Xc","self-center":"FhCy","overflow-hidden":"HTDu","overflow-y-visible":"wXSi",truncate:ne,"text-ellipsis":"_4end","whitespace-nowrap":"Ug5s","whitespace-pre-wrap":"AuNT",rounded:oe,"rounded-full":"a09b","rounded-sm":"MXUa","rounded-ee-sm":"QJ-0","rounded-ss-sm":"FquZ",border:ae,"border-b":"GEz-","border-l":"Df-n","border-t":"c-Gq","border-solid":"aquk","border-[#2e2e2e]":"NdRX","border-[#464646]":"a2jD","border-[#5e5e5e]":"_6TSs","border-[#dedede]":"D8As","border-gray300":"YYNS","border-gray400":"JYBF","border-green-600":"nX9-","border-red-500":"_7j5b","border-red-600":"_5s-2","border-slate-300":"V0CE","border-slate-400":"o9GV","bg-[#191919]":"J971","bg-[#2e2e2e]":"AiR4","bg-[#dedede]":"gqRe","bg-[#ff153c]":"QI70","bg-[#ff1f45]":"xRnt","bg-black":"NPEm","bg-black/[80%]":"IqWo","bg-gray700":"oPh-","bg-gray800":"XCvl","bg-transparent":"GCYy","bg-white":"nxtU","to-transparent":"tgi3","bg-contain":"qv4g","bg-cover":"_6jVU","bg-[50%_50%]":"nwRK","bg-no-repeat":"_33OL","object-cover":"IYqS","p-0":"xfcF","p-12":"HQzY","p-2":"OWIy","p-[1%]":"qvhA","px-0":"TaSA","px-0.5":"lJMR","px-10":"MPdA","px-20":"eXr4","px-4":"_3-es","px-5":"A0oV","px-[3%]":"U1Q-","px-[3.5%]":"LdIl","px-[3rem]":"mYZb","px-[5%]":"HItC","py-2":"Rfig","py-3":"_48iL","py-4":"t8Wc","py-6":"-NbK","py-[30%]":"dNt-","pb-2":"BieS","pb-3":"tCZ2","pb-[0.125rem]":"T11m","pb-[2.215rem]":"Nhkr","pb-[8%]":"v57K","pl-0":"UTQe","pl-5":"Nq25","pl-8":"XbTw","pl-[1.375rem]":"u28U","pl-[1rem]":"_7CAp","pl-[3rem]":"O6Mi","pl-[5%]":"V6bb","pr-3":"ubT3","pr-5":"DgZZ","pr-7":"-WhH","pr-[0.5rem]":"_8v1M","pr-[7px]":"yiYL","pt-1":"cGiJ","pt-10":"SvKO","pt-2":"_1teO","pt-32":"IMLo","pt-6":"u3OQ","pt-[0.5615rem]":"JxJz","pt-[0.5625rem]":"dcoN","pt-[0.5651rem]":"eCnZ","pt-[0.5rem]":"_0jPU","pt-[0.625rem]":"WjLW","pt-[12%]":"SCuG","pt-[15px]":"ln-K","pt-[1rem]":"obsO","pt-[2rem]":"Rpc-","pt-[7%]":"F2AL","text-left":"C-kb","text-center":"tJl0","text-right":"fOS1","align-middle":"hDyg","font-sans":"p-Xd","text-2xl":"WgfF","text-3xl":"paSh","text-4xl":"WlXh","text-[0.625rem]":"zTdq","text-[0.6875rem]":"_8-HE","text-[0.75rem]":"u-cJ","text-[0.875rem]":"QnQR","text-[0.9375rem]":"Vrow","text-[7rem]":"r8--","text-base":"Nj9g","text-lg":"lXf7","text-sm":"_3kva","text-xl":"oBMq","text-xs":"BGxV","font-[0.75rem]":"ss3B","font-bold":"Yowi","font-extrabold":"we2P","font-extralight":"NBXE","font-light":"a-3l","font-medium":"v3kF","font-normal":"_9fhG","font-semibold":"wijM",italic:le,"leading-3":"AlH4","leading-4":"mMec","leading-[6rem]":"o2ah","leading-relaxed":"zvRE","tracking-wide":"ImFT","tracking-wider":"Cu13","text-[#646464]":"R1nj","text-[#6e6e6e]":"k8EK","text-[#888888]":"RwYZ","text-[#A3A3A3]":"QkYv","text-[#a3a3a3]":"J4Me","text-[#a6a6a6]":"RkkZ","text-[#dedede]":"sbWK","text-[#ededed]":"_0iAN","text-[gray]":"zRKi","text-black":"T4pZ","text-gray-300":"oZbt","text-gray-400":"_5JvX","text-gray300":"egme","text-gray400":"RxZF","text-gray500":"bWHU","text-neutral-400":"_7CB9","text-red-400":"DfEs","text-red-500":"CWUa","text-slate-300":"_4JbF","text-white":"s0yA",underline:ce,"placeholder-slate-600":"r01y","opacity-0":"r7Mr","opacity-50":"kXf9","opacity-60":"_6jOt","opacity-[100%]":"-boU","saturate-100":"csO3",filter:de,"backdrop-blur-lg":"XHqt","transition-all":"kY8W","transition-colors":"-im-","transition-opacity":"TGqB","delay-[0s]":"UxRl","duration-100":"j2jL","duration-[0.05s]":"CADL","ease-[ease]":"br-C","ease-in-out":"YE2M","ease-linear":"jG4D",main:pe,article:me,articleBg:ue,articleTitle:he,gradation:xe,sharePopup:ge,tag:fe,titleInfo:be,imgBtn:we,shareImg:ve,facebookIcon:je,twitterIcon:ye,linkIcon:Ne,poster:Ie,moreInfo:Re,playBtn:Te,likeBtn:Se,heartBtn:ke,fullHeartBtn:Be,shareBtn:Ce,section:qe,sectionTitle:_e,programFont:Ee,sortBtn:Fe,sectionDiv:Pe,toggleBtn:Oe,circle:$e,off:De,on:Me,playOn:Ae,playOff:Ue,asc:Le,desc:He,reviewSection:Ve,starIcon:Xe,active:Ye,star:Ze,figureHoverEffect:Ge,reviewForm:Je,reviewInput:ze,reviewButton:Ke,reviewBox:Qe,editItem:We,reviewItem:et,deleteBtn:tt,editBtn:st,editInput:rt,"first-line:transform":"M2Mo","hover:border-white":"yIAc","hover:bg-white":"_3Bup","hover:text-white":"RTGe","dark:hover:bg-[#cc1030]":"mLY2","max-sm:px-12":"bVcb","md:pt-[1rem]":"hLMw","lg:pt-[1.5rem]":"p2cz"};function D({similar:i}){const[d,g]=o.useState(!0),[y,f]=o.useState(!1),p=o.useRef(null),b=o.useRef(null),w=m=>{g(m.isBeginning),f(m.isEnd)};return o.useEffect(()=>{(p.current||b.current)&&(d?p.current.classList.add("swiper-button-disabled"):p.current.classList.remove("swiper-button-disabled"),y?b.current.classList.add("swiper-button-disabled"):b.current.classList.remove("swiper-button-disabled"))},[d,y]),e.jsxs("section",{className:t.section,children:[e.jsx("span",{className:t.sectionTitle,children:"비슷한 TV 프로그램"}),e.jsx("div",{className:t.programFont,children:e.jsxs(F,{className:"detailSwiper detailPagenation px-[3rem]  overflow-y-visible  ",slidesPerView:7,spaceBetween:10,slidesPerGroup:7,breakpoints:{480:{slidesPerView:5},768:{slidesPerView:6},1024:{slidesPerView:7}},navigation:{prevEl:p.current,nextEl:b.current,keyboard:!0,onlyInViewport:!1},pagination:{clickable:!0},modules:[P,O],onInit:m=>{w(m),m.isBeginning&&p.current.classList.add("swiper-button-disabled")},onSlideChange:m=>{w(m)},children:[i.map((m,u)=>e.jsx($,{children:e.jsxs("figure",{className:`pt-[0.5625rem] ${t.figureHoverEffect}`,children:[e.jsx("img",{src:m.thumbUrl,alt:`Episode Thumbnail ${u}`}),e.jsx("figcaption",{className:" pt-[0.5625rem]",children:e.jsx("h4",{children:m.info})})]})},u)),e.jsx(q,{className:`swiper-button-prev ${d?"opacity-0":"opacity-60"}`,ref:p}),e.jsx(q,{className:`swiper-button-next ${y?"opacity-0":"opacity-60"}`,ref:b})]})})]})}D.propTypes={similar:r.arrayOf(r.shape({thumbUrl:r.string.isRequired,info:r.string.isRequired})).isRequired};function M({isToggled:i,onToggle:d}){return e.jsx("button",{className:`text-white ${t.toggleBtn} ${i?`${t.on}`:`${t.off}`}`,type:"submit",onClick:d,children:e.jsx("div",{className:t.circle})})}M.propTypes={isToggled:r.bool.isRequired,onToggle:r.func.isRequired};function A({state:i,setState:d,title:g,episodeThumbs:y,sortKey:f}){const[p,b]=o.useState(!0),[w,m]=o.useState(!1),u=o.useRef(null),N=o.useRef(null),S=n=>{b(n.isBeginning),m(n.isEnd)};o.useEffect(()=>{(u.current||N.current)&&(p?u.current.classList.add("swiper-button-disabled"):u.current.classList.remove("swiper-button-disabled"),w?N.current.classList.add("swiper-button-disabled"):N.current.classList.remove("swiper-button-disabled"))},[p,w]);const[k,I]=o.useState(!0),[h,s]=o.useState(!1),j=()=>{s(!h)},l=()=>{const n=[...i.episodes].sort((a,c)=>{const v=parseInt(a.title.split(",")[0]),x=parseInt(c.title.split(",")[0]);return v-x});d(a=>({...a,episodes:n})),I(!0)},R=()=>{const n=[...i.episodes].sort((a,c)=>{const v=parseInt(a.title.split(",")[0]);return parseInt(c.title.split(",")[0])-v});d(a=>({...a,episodes:n})),I(!1)};return e.jsxs("section",{className:t.section,children:[e.jsx("hr",{className:"border-gray400"}),e.jsxs("div",{className:t.sectionDiv,children:[e.jsxs("button",{className:t.sectionTitle,type:"submit",children:[g,e.jsx("div",{children:y.map((n,a)=>e.jsx("img",{src:n,alt:`Episode Thumbnail ${a}`},a))})]}),e.jsxs("div",{className:t.sortBtn,children:[e.jsx("button",{className:`${k?`${t.asc}`:`${t.desc}`}`,type:"submit",onClick:l,children:"첫화부터"}),e.jsx("button",{className:`pl-[1.375rem] mr-[2.375rem] ${k?`${t.desc}`:`${t.asc}`}`,type:"submit",onClick:R,children:"최신화부터"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:` pr-[0.5rem] ${h?`${t.playOn}`:`${t.playOff}`}`,children:"연속재생"}),e.jsx(M,{isToggled:h,onToggle:j})]})]})]}),e.jsx("div",{className:" w-full font-semibold",children:e.jsxs(F,{className:"px-[3rem] detailSwiper",spaceBetween:10,modules:[O,P],slidesPerView:4,tabIndex:0,breakpoints:{480:{slidesPerView:2},768:{slidesPerView:3},1024:{slidesPerView:4}},navigation:{prevEl:u.current,nextEl:N.current,keyboard:{enabled:!0,onlyInViewport:!1}},onInit:n=>{S(n),n.isBeginning&&u.current.classList.add("swiper-button-disabled")},onSlideChange:n=>{S(n)},children:[i.episodes.map((n,a)=>e.jsx($,{children:e.jsxs("figure",{className:`pt-[0.5625rem] ${t.figureHoverEffect}`,children:[e.jsx("img",{src:n.thumbUrl,alt:`Episode Thumbnail ${a}`}),e.jsxs("figcaption",{className:" pt-[0.5625rem]",children:[e.jsx("h4",{className:"text-white text-lg",children:n.title}),e.jsx("p",{children:n.info})]})]})},a)),e.jsx(q,{className:`swiper-button-prev ${p?"opacity-0":"opacity-60"}`,ref:u}),e.jsx(q,{className:`swiper-button-next ${w?"opacity-0":"opacity-60"}`,ref:N})]},f)})]})}A.propTypes={state:r.shape({episodes:r.arrayOf(r.shape({title:r.string.isRequired})).isRequired}).isRequired,setState:r.func.isRequired,title:r.string.isRequired,episodeThumbs:r.arrayOf(r.string).isRequired,handleClick:r.func.isRequired,sortKey:r.any.isRequired};const it="/react-project-7/assets/twitter-logo.png",nt="/react-project-7/assets/share-logo.png",ot="/react-project-7/assets/facebook-logo.png";function C({platform:i,url:d,src:g}){const y=()=>{if(i==="Facebook"){const f=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(d)}`;window.open(f,"_blank")}else if(i==="Twitter"){const p=`https://twitter.com/intent/tweet?text=${encodeURIComponent("티빙! 오리지널을 만나보세요.")}&url=${encodeURIComponent(d)}`;window.open(p,"_blank")}else i==="Link"&&(navigator.clipboard.writeText(d),alert("링크가 복사되었습니다!"))};return e.jsx("button",{type:"button",onClick:y,children:e.jsx("img",{className:t[`${i.toLowerCase()}Icon`],src:g,alt:`${i} 공유 아이콘`})})}C.propTypes={platform:r.string.isRequired,url:r.string.isRequired,src:r.string.isRequired};function U({state:i,setState:d,ratingText:g,versionText:y,setIsShareOpen:f,isShareOpen:p,contentType:b,id:w}){const[m,u]=o.useState(!1),[N,S]=o.useState(null);o.useEffect(()=>{var l;const s=JSON.parse(localStorage.getItem("pocketbase_auth")||"{}"),j=(l=s==null?void 0:s.model)==null?void 0:l.id;j&&S(j)},[]);const[k,I]=o.useState({favoriteProgram:[],favoriteMovie:[]}),h=async()=>{let s;try{const j=await T.collection("users").getOne(N);let l={favoriteProgram:[...j.favoriteProgram],favoriteMovie:[...j.favoriteMovie]};b==="program"?(s=l.favoriteProgram?[...l.favoriteProgram]:[],m?s=s.filter(R=>R!==w):s.push(w),l.favoriteProgram=s):b==="movie"&&(s=l.favoriteMovie?[...l.favoriteMovie]:[],m?s=s.filter(R=>R!==w):s.push(w),l.favoriteMovie=s),await T.collection("users").update(N,l),u(!m),I(l)}catch(j){console.error("Failed to update favorites",j)}};return e.jsxs("article",{className:t.article,children:[e.jsx("div",{className:`${t.gradation} -translate-x-1/2 -translate-y-1/2`,children:e.jsx("div",{className:t.poster,style:{backgroundImage:`url(${i.poster})`}})}),e.jsxs("div",{className:t.articleBg,children:[e.jsxs("div",{className:"w-2/5 p-[1%]",children:[e.jsx("h2",{className:t.articleTitle,children:i.title}),e.jsxs("div",{className:"border-gray300 ",children:[e.jsx("span",{className:t.tag,children:i.release}),e.jsx("span",{className:t.tag,children:g[i.rating]}),i.runningTime&&e.jsxs("span",{className:t.tag,children:[i.runningTime,"분"]}),i.version!=="X"&&i.version&&i.version!=="x"&&e.jsx("span",{className:t.tag,children:y[i.version]}),i.producer&&e.jsx("span",{className:t.tag,children:i.producer}),i.season&&e.jsxs("span",{className:t.tag,children:["시즌",i.season]}),i.subtitle&&e.jsx("span",{className:t.tag,children:"자막"}),i.isDRM&&e.jsx("span",{className:t.tag,children:"DRM"})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("button",{className:t.playBtn,type:"submit",children:[e.jsx("span",{className:"text-center",children:"▶"})," 시청하기"]}),e.jsxs("button",{className:t.likeBtn,type:"submit",onClick:h,children:[e.jsx("img",{className:t.imgBtn,src:m?"assets/full-heart.svg":"assets/heart.svg",alt:"하트 버튼"}),e.jsx("span",{className:"text-white",children:"찜"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:t.likeBtn,type:"submit",onClick:()=>f(!p),children:[e.jsx("img",{className:t.shareBtn,alt:"공유 버튼"}),e.jsx("span",{className:"text-white",children:"공유"})]}),p&&e.jsxs("div",{className:`${t.sharePopup} flex justify-around items-center`,children:[e.jsx(C,{platform:"Link",url:window.location.href,src:nt}),e.jsx(C,{platform:"Facebook",url:"https://www.facebook.com/sharer/sharer.php",src:ot}),e.jsx(C,{platform:"Twitter",url:window.location.href,src:it})]})]})]}),e.jsxs("dl",{className:"flex mt-[1.5625rem] font-semibold",children:[e.jsx("dt",{className:t.titleInfo,children:"크리에이터"}),e.jsx("dd",{className:t.truncate,children:i.creator})]}),e.jsxs("dl",{className:"flex font-semibold",children:[e.jsx("dt",{className:t.titleInfo,children:"출연"}),e.jsx("p",{className:`${t.actor} ${t.truncate}`,children:i.actor})]}),e.jsx("p",{className:`${t.moreInfo} ${i.showFullDescription?"":t.truncate}`,children:i.description}),e.jsx("button",{onClick:()=>d(s=>({...s,showFullDescription:!s.showFullDescription})),type:"button",children:i.showFullDescription?"접기":"더보기"})]}),e.jsx("div",{className:"w-[23%]",children:e.jsx("img",{className:"",src:i.poster})})]})]})}U.propTypes={state:r.shape({showFullDescription:r.bool,title:r.string,producer:r.bool,poster:r.string,actor:r.string,creator:r.string,description:r.string,release:r.string,rating:r.number,version:r.string,season:r.bool,subtitle:r.bool,isDRM:r.bool,runningTime:r.number}).isRequired,ratingText:r.object.isRequired,versionText:r.object.isRequired,handleHeart:r.func.isRequired,isChanged:r.bool.isRequired,setIsShareOpen:r.func.isRequired,setState:r.func.isRequired,isShareOpen:r.bool.isRequired,contentType:r.string.isRequired,id:r.string.isRequired};function L({star:i="별점",writer:d="글쓴이",comment:g="리뷰",commentId:y,writerId:f}){var R;const[p,b]=o.useState(!1),[w,m]=o.useState(!1),[u,N]=o.useState(g),[S,k]=o.useState(g),I=JSON.parse(localStorage.getItem("pocketbase_auth")||"{}"),h=(R=I==null?void 0:I.model)==null?void 0:R.id,s=async()=>{if(console.log(h,f),h!==f){alert("본인의 리뷰만 삭제할 수 있습니다.");return}try{await T.collection("review").delete(y),m(!0)}catch(n){console.error(n)}},j=()=>{if(h!==f){alert("본인의 리뷰만 수정할 수 있습니다.");return}b(!0)},l=async n=>{if(!p)return;const a={contents:u};try{await T.collection("review").update(n,a),b(!1),k(u)}catch(c){throw new Error(c.message)}};return e.jsx(e.Fragment,{children:w?e.jsx(e.Fragment,{children:e.jsx("p",{className:" pl-[1rem] pt-[0.625rem] mt-[1rem] ml-[3rem]",children:"관리자만 접근이 가능합니다."})}):e.jsxs("div",{className:t.editItem,children:[e.jsx("div",{children:Array.from({length:i},(n,a)=>e.jsx("span",{children:"⭐"},a))}),e.jsxs("div",{className:" flex row",children:[d,"  : ",p?e.jsx("input",{className:"text-[gray]",type:"text",value:u,onChange:n=>N(n.target.value)}):e.jsx("div",{className:"",children:u}),p&&e.jsx("div",{className:" cursor-pointer ",children:e.jsx("ul",{className:"flex row",children:e.jsx("li",{className:" ml-[0.3125rem] mt-[0.2em]",children:e.jsx("button",{onClick:()=>l(y),children:"수정"})})})}),!p&&e.jsxs(e.Fragment,{children:[e.jsx("span",{onClick:j,className:`${t.deleteBtn} text-[gray]`,children:"수정"}),e.jsx("span",{onClick:s,className:`${t.deleteBtn} text-red-500`,children:"삭제"})]})]})]})})}L.propTypes={star:r.number.isRequired,writer:r.string.isRequired,comment:r.string.isRequired,commentId:r.string.isRequired,writerId:r.string.isRequired};function H({id:i,contentType:d}){const[g,y]=o.useState(0),[f,p]=o.useState(0),[b,w]=o.useState(""),[m,u]=o.useState([]),[N,S]=o.useState(null),[k,I]=o.useState([]),[h,s]=o.useState(""),j=o.useRef(null),l=n=>{N!==null?s(n.target.value):w(n.target.value)};o.useEffect(()=>{(async()=>{var a;try{const c=await T.collection(d).getOne(i,{expand:"reviews,reviews.writer"});(a=c==null?void 0:c.expand)!=null&&a.reviews&&u(c.expand.reviews)}catch(c){console.error("Failed to fetch reviews",c)}})()},[i,d]);const R=async n=>{var v;n.preventDefault();const a=JSON.parse(localStorage.getItem("pocketbase_auth")||"{}"),c=(v=a==null?void 0:a.model)==null?void 0:v.id;if(g===0){alert("별점을 설정해주세요.");return}if((b!==""||h!=="")&&g!==null)try{let x;N!==null?x={text:h,stars:g.toString()}:x={text:b,stars:g.toString()};let E={star:x.stars,writer:c,contents:x.text,programId:i},B=await T.collection("review").create(E);B&&(await T.collection("users").update(c,{"review+":B.id}),await T.collection(d).update(E.programId,{"reviews+":B.id}));let V=await T.collection("review").getOne(B.id,{expand:"writer, reviews.writer"});u(X=>[...X,V])}catch(x){console.error(x)}};return e.jsxs("section",{className:t.reviewSection,children:[e.jsx("hr",{className:"border-gray400 pt-[15px]"}),e.jsx("span",{className:`mb-[0.9375rem]  ${t.sectionTitle}`,children:"Review"}),e.jsx("div",{className:t.reviewBox,children:e.jsxs("form",{onSubmit:R,className:t.reviewForm,children:[[...Array(5)].map((n,a)=>{const c=a+1;return e.jsx("span",{className:`${t.starIcon} ${c<=(f||g)?t.active:""}`,onMouseEnter:()=>p(c),onMouseLeave:()=>p(g),onClick:()=>y(c),children:"★"},a)}),e.jsx("input",{className:t.reviewInput,value:b,ref:j,onChange:l}),e.jsx("button",{className:t.reviewButton,type:"submit",children:"리뷰 제출"})]})}),e.jsx("div",{children:e.jsx("ul",{className:"",children:m.map(n=>e.jsx(L,{star:n.star,writer:n.expand.writer.username,writerId:n.expand.writer.id,comment:n.contents,commentId:n.id,onCommentChange:I},n.id))})})]})}H.propTypes={id:r.string.isRequired,contentType:r.string.isRequired};function pt(){const[i,d]=o.useState({showFullDescription:!1,title:"",producer:!1,poster:"",actor:"",creator:"",description:"",release:"",rating:"",version:"",season:!1,subtitle:!1,isDRM:!1,runningTime:!1,episodes:[],similar:[],related:[],episodeTitles:"",episodeThumbs:[],similarThumbs:[],relatedTitles:""}),g={all:"전체 이용가",eighteen:"18세",twelve:"12세",fifteen:"15세",seven:"7세",nineteen:"19세"},y={dubbed:"더빙판",subtitle:"자막판"},{id:f}=Z(),[p,b]=o.useState([]),[w,m]=o.useState("");o.useEffect(()=>{const I=async h=>{try{const s=await T.collection(h).getOne(f,{expand:"reviews,reviews.writer"});m(s.collectionName);const{expand:j}=s;j&&b(j.reviews);let l={};if(s.poster&&(l.poster=_(s,"poster")),s.episodeThumbs&&s.episodeTitles&&s.episodeInfos){const n=s.episodeThumbs.map(x=>_({collectionId:s.collectionId,id:s.id,[x]:x},x)),a=s.episodeTitles.split(","),c=s.episodeInfos.split(","),v=[];for(let x=0;x<n.length;x++)c[x]&&v.push({thumbUrl:n[x],title:a[x],info:c[x]});l.episodes=v}if(s.similarThumbs&&s.similarInfos){const n=s.similarThumbs.map(v=>_({collectionId:s.collectionId,id:s.id,[v]:v},v)),a=s.similarInfos.split(","),c=[];for(let v=0;v<n.length;v++)a[v]&&c.push({thumbUrl:n[v],info:a[v]});l.similar=c}const R=["title","actor","creator","description","producer","release","season","subtitle","rating","isDRM","episodeTitles","version"];for(let n of R)s[n]&&(l[n]=s[n]);return h==="movie"&&s.runningTime&&(l.runningTime=s.runningTime),h==="movie"&&s.version&&(l.version=s.version),l}catch(s){console.error(`Failed to fetch ${h} data`,s)}};Promise.all([I("program"),I("movie")]).then(([h,s])=>{d(j=>({...j,...h,...s}))}).catch(h=>console.error(h))},[f]);const[u,N]=o.useState(0),[S,k]=o.useState(!1);return e.jsxs("main",{className:`text-gray300 ${t.main} w-screen overflow-hidden px-[3%]`,children:[e.jsxs(Y,{children:[e.jsx("title",{children:"타잉 7조 - 상세 페이지"}),e.jsx("meta",{name:"description",content:"멋쟁이 사자처럼 6기 7조의 파이널 프로젝트 - 티빙 클론코딩 상세 페이지"}),e.jsx("meta",{property:"og:type",content:"website"}),e.jsx("meta",{property:"og:title",content:"타잉 상세 페이지"}),e.jsx("meta",{property:"og:description",content:"프로젝트 타잉 상세 페이지"}),e.jsx("meta",{property:"og:image",content:"@/assets/metaImgDetail.png"}),e.jsx("meta",{property:"og:url",content:"https://frontendschool6.github.io/react-project-7/#/contents/:id"})]}),e.jsx(U,{setState:d,state:i,ratingText:g,versionText:y,setIsShareOpen:k,isShareOpen:S,contentType:w,id:f}),e.jsxs("div",{children:[w!=="movie"&&e.jsxs(e.Fragment,{children:[e.jsx(A,{state:i,setState:d,title:i.title,episodeThumbs:i.episodeThumbs,sortKey:u}),e.jsx(D,{similar:i.similar})]}),e.jsx(H,{id:f,contentType:w})]})]})}export{pt as default};
