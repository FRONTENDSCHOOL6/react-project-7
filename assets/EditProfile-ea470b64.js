import{P as x,j as e,i as n,g as N,u as I,p as d}from"./index-216c0cc6.js";import{r as u}from"./react-7b82c02c.js";import{D as j}from"./default-profile-3d4ff587.js";import{u as B,a as T}from"./reactRouter-08e27dd4.js";import"./extra-3c07f53d.js";const $="xKHh",k="_7YBS",q="tCbo",h={button:$,primary:k,secondary:q};function b({onClick:a,type:r,text:f}){const l=r==="primary"?h.primary:h.secondary;return e.jsx("button",{type:"button",onClick:a,className:`${h.button} ${l}`,children:f})}b.propTypes={onClick:x.func,type:x.oneOf(["primary","secondary"]).isRequired,text:x.string.isRequired};function w({handleSaveProfile:a,handleCancel:r}){return e.jsxs("div",{className:"w-1/2 flex justify-between gap-3",children:[e.jsx(b,{type:"primary",onClick:a,text:"확인"}),e.jsx(b,{type:"secondary",onClick:r,text:"취소"})]})}w.propTypes={handleSaveProfile:n.func.isRequired,handleCancel:n.func.isRequired};const O="DtR6",_="Ix8B",U="_--gI",W="EfUi",Y="_13Ys",y={profileListSection:O,profileListWrapper:_,editProfileSection:U,editButton:W,editInput:Y};function v({isLoading:a,updatedUser:r,profileData:f,handlePosterChange:l,handleNameChange:o}){return e.jsxs("div",{className:y.editProfileSection,children:[e.jsx("button",{type:"button",className:`${y.editButton} `,children:a?e.jsx("div",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"poster",className:"cursor-pointer",children:e.jsx("img",{src:r!=null&&r.poster?r==null?void 0:r.poster:N(f,"poster"),alt:"유저 프로필 이미지",onError:p=>{p.target.onerror=null,p.target.src=j},className:"w-[13.87rem] h-[13.875rem] object-cover opacity-50"})}),e.jsx("input",{type:"file",id:"poster",accept:".jpg,.png,.svg,.webp",onChange:l,style:{display:"none"}})]})}),e.jsxs("div",{className:"editName w-1/2",children:[e.jsx("label",{htmlFor:"username",children:e.jsx("input",{type:"text",name:"username",id:"username",value:r.username,onChange:o,maxLength:"10",className:y.editInput})}),e.jsx("p",{className:"text-base text-neutral-400 my-2",children:"* 2자 이상 10자 이내의 한글, 영문, 숫자 입력 가능합니다."})]})]})}v.propTypes={isLoading:n.bool,updatedUser:n.shape({username:n.string,poster:n.string,posterFile:n.string}),profileData:n.shape({username:n.string,poster:n.string}),handlePosterChange:n.func,handleNameChange:n.func};function A(){return e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("h2",{className:"text-4xl text-center font-bold",children:"프로필 편집"})})}function M(){const a=B(),l=T().pathname.split("/").pop(),{authState:o}=I(),[p,S]=u.useState({username:""}),[L,P]=u.useState(!0),[c,m]=u.useState({username:"",poster:"",posterFile:null});u.useEffect(()=>{var i;(async()=>{try{P(!0);const s=await d.collection("profile").getOne(l);S(s);const g=c.poster||(s.poster?N(s,"poster"):j);m({username:s.username,poster:g,posterFile:null})}catch(s){console.log(s)}finally{P(!1)}})((i=o==null?void 0:o.user)==null?void 0:i.id)},[o,l]);const C=async(t,i)=>{try{return await d.collection("profile").update(t,i)}catch(s){throw console.error(s),s}},F=t=>{m({...c,username:t.target.value})},E=t=>{t.target.files[0]&&m({...c,poster:URL.createObjectURL(t.target.files[0]),posterFile:t.target.files[0]})};console.log(l);const R=async()=>{var t;try{const i=new FormData;i.append("username",c.username),c.posterFile&&i.append("poster",c.posterFile),await C(p.id,i);const s=await d.collection("profile").getOne(l),g=d.files.getUrl(s,s.poster);m({username:s.username,poster:g||j,posterFile:null}),alert("저장 완료!"),a(`/profile/${(t=o==null?void 0:o.user)==null?void 0:t.id}`)}catch(i){console.error(i)}};console.log(p),u.useEffect(()=>{},[]);const D=()=>{var t;window.confirm("이 페이지를 벗어나면 변경된 내용은 저장되지 않습니다. 그래도 진행하시겠습니까?")?a(`/editprofiles/${(t=o==null?void 0:o.model)==null?void 0:t.id}`):console.log("프로필 편집 취소")};return e.jsx("section",{className:"bg-black w-screen h-screen flex items-center justify-center text-white my-auto relative pt-[2rem] lg:pt-[1.5rem] md:pt-[1rem]",children:e.jsxs("div",{className:"flex flex-col justify-center items-center min-h-full gap-10 w-2/3",children:[e.jsx(A,{}),e.jsx(v,{isLoading:L,updatedUser:c,profileData:p,handlePosterChange:E,handleNameChange:F}),e.jsx(w,{handleSaveProfile:R,handleCancel:D})]})})}export{M as default};
